apiVersion: apps/v1
kind: Deployment
metadata:
  name: bootstrap
  namespace: bootstrap
  labels:
    app: bootstrap
spec:
  replicas: 1
  revisionHistoryLimit: 10
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: bootstrap
  template:
    metadata:
      labels:
        app: bootstrap
    spec:
      containers:
        - image:  quay.io/jhorn/kubesealer-oc-ubi
          imagePullPolicy: Always
          name: bootstrap
          command: ["/bin/bash", "/scri" ]
          env:
            - name: GIT_REPO
              valueFrom:
                configMapKeyRef:
                  name: args
                  key: gitrepo
            - name: INFRA_NODES
              valueFrom:
                configMapKeyRef:
                  name: args
                  key: nodes
          args: [ "while true;  do sleep 1000; done;"]
          volumeMounts:
            - mountPath: /run/bootstrap/tlscert
              name: tls-certs
            - mountPath: /run/bootstrap/idp
              name: idp-secret
            - mountPath: /run/bootstrap/git
              name: git
            - mountPath: /scripts
              name: da-script
      volumes:
        - name: da-script
          configMap:
            name: script
            defaultMode: 0744
        - name: tls-certs
          secret:
            secretName: tls-custom-cert
        - name: idp-secret
          secret:
            secretName: idp-secret
        - name: git
          secret:
            secretName: repo-github
      restartPolicy: Always
      serviceAccountName: bootstrap

